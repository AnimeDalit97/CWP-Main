set_global_pollution_amount = {
	every_scope_state = {
		change_global_variable = {
			name = global_var_pollution
			add = var:var_state_pollution_amount
			round = yes
		}
	}
}

set_state_pollution_amount = {
	every_scope_state = {
		set_variable = {
			name = var_state_pollution_amount
			value = this.state_region.pollution_amount
		}
	}
}

set_state_pollution_generation = {
	every_scope_state = {
		set_variable = {
			name = var_state_pollution_generation
			value = this.pollution_generation
		}
	}
}

calc_temperature_change = {
	set_local_variable = {
		name = distance_from_threshold
		value = global_var:global_var_pollution
	}
	change_local_variable = {
		name = distance_from_threshold
		subtract = global_pollution_threshold
	}
	set_local_variable = {
		name = percent_from_threshold
		value = local_var:distance_from_threshold
	}
	change_local_variable = {
		name = percent_from_threshold
		divide = maximum_distance_from_pollution_threshold
	}
	if = {
		limit = {
			global_var:global_var_temperature_kelvins <= global_temperature_floor
		}
		debug_log = "temperature floor reached"
		set_global_variable = {
			name = global_var_temperature_kelvins
			value = global_temperature_floor
		}
	}
	else = {
		debug_log = "changing temperature"
		change_global_variable = {
			name = global_var_temperature_kelvins
			add = local_var:percent_from_threshold
		}
	}
}

global_temperature_to_celsius = {
	set_global_variable = {
		name = global_var_temperature_celsius
		value = global_var:global_var_temperature_kelvins
	}
	change_global_variable = {
		name = global_var_temperature_celsius
		subtract = 273.15
	}
}
